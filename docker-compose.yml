version: '3.1'

services:
    nginx:
        restart: always
        image: nginx:1.15.4
        ports:
            - ${NGINX_HTTP_PORT}:80
            - ${NGINX_SSL_PORT}:443
        volumes:
            # Транслируем папку приложения, в том числе недоступные из веба файлы:
            - ./www:/var/www/:Z
            # Подключим файл конфига Nginx:
            - ./.docker_build_configs/nginx/default.conf:/etc/nginx/conf.d/default.conf:Z
            # Транслируем логи из контейнера на хост:
            #- ./logs:/var/log/:Z
        links:
            - phpfpm

    phpfpm:
        restart: always
        build:
            context: .
            dockerfile: ./.docker_build_configs/php_fpm/Dockerfile
        volumes:
            # Транслируем папку приложения, в том числе недоступные из веба файлы:
            - ./www:/var/www/:Z
            # Изменяем некоторые значения в php.ini:
            - ./.docker_build_configs/php_fpm/my_extra_php.ini:/usr/local/etc/php/conf.d/my_extra_php.ini:Z

volumes:
    persistent:
